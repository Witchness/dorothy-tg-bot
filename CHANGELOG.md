# CHANGELOG ‚Äî Dorothy Telegram Bot

## 2025-09-30 ‚Äî –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è persistence —Ç–∞ —Ä–µ–∞–∫—Ü—ñ–π

### ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

1. **–†–µ–∞–∫—Ü—ñ—ó —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—é—Ç—å** (‚ù§Ô∏è –Ω–∞ —É—Å–ø—ñ—Ö, üëé –Ω–∞ –ø–æ–º–∏–ª–∫—É)
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: `createSimpleReactions()` —Ç–µ–ø–µ—Ä –ø—Ä–∏–π–º–∞—î `bot.api` —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
   - –í–∏–¥–∞–ª–µ–Ω–æ —Ö–∏–±–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `chatType === "private"` (—Ä–µ–∞–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å —É –≤—Å—ñ—Ö —Ç–∏–ø–∞—Ö —á–∞—Ç—ñ–≤)
   - –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `{ is_big: false }` –∑–≥—ñ–¥–Ω–æ grammY API

2. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ**
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∏–ø `is_bot`: boolean ‚Üí number (0/1) –¥–ª—è SQLite
   - –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ (upsert user/chat, insert message/attachments)
   - CRITICAL –ø–æ–º–∏–ª–∫–∏ —Ç–µ–ø–µ—Ä —á—ñ—Ç–∫–æ –≤–∏–¥–∏–º—ñ –≤ –∫–æ–Ω—Å–æ–ª—ñ

3. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ URL: `https://api.telegram.org/file/bot{TOKEN}/{file_path}` (–±—É–≤ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –ø—Ä–µ—Ñ—ñ–∫—Å `bot`)
   - –î–æ–∫—É–º–µ–Ω—Ç–∏ —Ç–µ–ø–µ—Ä –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º (.pdf, .zip, .mp4 —Ç–æ—â–æ)
   - –î–ª—è animations (GIF) –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è –¥—É–±–ª—ñ–∫–∞—Ç document
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

4. **API –Ω–æ–≤—ñ –∫–ª—é—á—ñ —Ç–µ–ø–µ—Ä –∑ –∫–Ω–æ–ø–∫–∞–º–∏**
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "New API response keys for X" —Ç–µ–ø–µ—Ä –≤–∫–ª—é—á–∞—î inline –∫–Ω–æ–ø–∫–∏ (‚úÖ process / üö´ ignore / üü® review)
   - –ú–∞–∫—Å–∏–º—É–º 3 –∫–ª—é—á—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—ñ

5. **–ü—Ä–æ–¥–∞–∫—à–Ω-–ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–∞**
   - –í REGISTRY_MODE=prod: –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ—Å–∏–ª–∞—î—Ç—å—Å—è –æ—Ä–∏–≥—ñ–Ω–∞–ª + –∞–Ω–∞–ª—ñ–∑ + –¥–µ—Ç–∞–ª—ñ –∞–¥–º—ñ–Ω—É
   - Inline –∫–Ω–æ–ø–∫–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å–∞–º–∏
   - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–¥–æ–¥–∞—Ç–∏ –∫–ª—é—á—ñ" —Ç—ñ–ª—å–∫–∏ –≤ debug —Ä–µ–∂–∏–º—ñ

### üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω

- **Persistence**: –í—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—Ç–µ–∫—Å—Ç + attachments) –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ SQLite –ë–î + —Ñ–∞–π–ª–∏
- **Reactions**: ‚ù§Ô∏è —Å—Ç–∞–≤–∏—Ç—å—Å—è –Ω–∞ —É—Å–ø—ñ—à–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- **–ë–î —Å—Ö–µ–º–∞**: users, chats, messages (–∑ –ø–æ–≤–Ω–∏–º JSON), attachments, events, errors, schema_requests
- **–§–∞–π–ª–∏**: –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `data/messages/{userId}/{messageId}/` –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º–∏

### üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

- –°—Ç–≤–æ—Ä–µ–Ω–æ `test-reactions.ts` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–µ–∞–∫—Ü—ñ–π (–≤—Å—ñ 5 —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–æ–π–¥–µ–Ω—ñ —É—Å–ø—ñ—à–Ω–æ)
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ —Ä–æ–±–æ—Ç—É –≤ –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö —á–∞—Ç–∞—Ö

### üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

- Node.js 22+, TypeScript, grammY
- SQLite (better-sqlite3) –∑ WAL —Ä–µ–∂–∏–º–æ–º
- Atomic file writes (Windows-safe)
- Debug –ª–æ–≥—É–≤–∞–Ω–Ω—è: `DEBUG=debug npm run dev`